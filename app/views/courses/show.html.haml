%h1
  = @course.title
%p
  taught by
  = link_to @course.teacher.username, @course.teacher, class: 'big'
  in
  = link_to @course.category, courses_path(category: @course.category), class: 'big'

- unless enrolled? @course
  - if @course.free?
    %p= link_to "Enroll", new_enrollment_path(course_id: @course.id), class: 'btn btn-success'
  - else
    %p= link_to "Enroll for #{@course.price_in_words}", course_orders_path(@course), class: 'btn btn-success', method: :post
    
- if Rails.env.development? && ! @course.free?
  %p= link_to "Buy for #{@course.price_in_words} (dev mode)", course_orders_path(@course), class: 'btn btn-primary', method: :post

.break
.big
  %h3 Course Description
  = @course.description.html_safe

.break

%h3 Course Layout
= render partial: 'layouts/list', locals: { list: @course.sections }

.break

%h3 About the Teacher
%h4
  - if @course.teacher.avatar_url
    = avatar_tag @course.teacher, height: 25
  = @course.teacher.username
%p.big
  - if @course.teacher.teacher_description
    = @course.teacher.teacher_description.html_safe
  - else
    %em This teacher has not given any information about themselves

.break
%h3
  Enrolled Students
  == (#{@course.enrolled_students.size})

%ul
- @course.enrolled_students.each do |student|
  %li.big.user-list
    - if student.avatar_url
      = avatar_tag student, height: 17
    = link_to student.username, student
    == (#{student.points})

= comment_area @course
  
- if enrolled? @course
  .break
    %p If you unenroll, your progress will be saved if you decide to re-enroll in the class.
    - enrollment = @course.enrollments.where("user_id = ?", current_user.id).first
    %p= link_to "Unenroll", enrollment, method: :delete, class: 'btn'

- if can? :manage, @course
  .break
  %h3 Admin Actions
  .btn-group
    = link_to 'Edit', edit_course_path(@course), class: 'btn'
    = link_to 'Delete', @course, method: :delete, confirm: "Are you sure you want to delete this course? You cannot undo this action.", class: 'btn'
  .break


- content_for :sidebar do
  %li.nav-header Current Course
  %li= link_to @course.title, @course
  = sidebar_list @course.sections
  %br
  %li= link_to "Message Board", polymorphic_path([@course, Discussion])
  - if can? :manage, @course
    %li.active.bottom= link_to "New Section", new_course_section_path(@course)

- t @course.title