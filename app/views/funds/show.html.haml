%h1= @fund.title
%br
%h4
  Created By
  = link_to user_display(@fund.user), @fund.user

.break

= link_to "Support this Fund!", new_fund_order_path(@fund), class: 'btn btn-success btn-large'
%p You will not be charged until you get access to course materials.

- if @fund.hidden != false && can?(:manage, @fund)
  .break
  %em This fund is hidden.
  %br
  - if @fund.user.stripe_key
    = link_to "Make this fund visible", fund_path(@fund, fund: {hidden: false}), method: :patch, class: 'btn btn-primary'
  - else
    %em You need to configure your payment information before making this course visible.
    %br
    %br
    = link_to "Update payment information", payment_path, class: 'btn btn-primary'

.break
%h4 About the Teacher
.big
  - if @fund.user.teacher_description.blank?
    %em This teacher has not given a description for themselves yet.
  - else
    = @fund.user.teacher_description.html_safe

.break
%h4 About this Fund
.big
  = @fund.body.html_safe

.break

= comment_area @fund


- if can? :manage, @fund
  .break
  %h4 Admin Actions
  .btn-group
    = link_to "Edit", edit_fund_path(@fund), class: 'btn'
    - if @fund.hidden == false
      = link_to "Hide", fund_path(@fund, fund: {hidden: true}), method: :patch, class: 'btn'
    = link_to "Delete", @fund, method: :delete, confirm: "Are you sure you want to delete this fund? This action cannot be undone.", class: 'btn'


- content_for :sidebar do
  = progress_tag (@fund.percent_complete)
  %li.nav-header Goal Details
  %li.big
    Raised
    %strong= number_to_currency(@fund.progress)
    out of
    %strong= number_to_currency(@fund.goal)
  %br
  %li.big
    ending in
    %strong= @fund.time_ending
  %br
  %li.big= link_to "Support for <strong>#{number_to_currency(@fund.price)}</strong>".html_safe, fund_orders_path(@fund), class: 'light-purple', method: :post
  %li.nav-header= "#{pluralize(@fund.orders.count, 'backer')}"
  - @fund.orders.grouped.each do |order|
    - if order.user_id
      %li
        %a{href: user_path(order.user)}
          = user_display(order.user) if order.user
          %span -
          %strong= number_to_currency(order.sum)
