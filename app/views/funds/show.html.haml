%h1= @fund.title
%br
%h4
  Created By
  = link_to user_display(@fund.user), @fund.user

.break

- if logged_in?
  .div
    = link_to "Pay with Card", new_fund_order_path(@fund), class: 'btn btn-success btn-large'
    - dummy_order = current_user.orders.new
    - dummy_order.orderable = @fund
    = coinbase_button(dummy_order, current_user)
  %br
  - ab_test "show_credit_card_no_charge_message", "true", "false" do |test|
    - if test == "true"
      %p Your credit card will not be charged until you get access to course materials.
- else
  %p You need to create an account to support this fund. It only takes a second!
  %p= link_to "Sign Up", new_user_path, class: "btn btn-large"

- if @fund.hidden != false && can?(:manage, @fund)
  .break
  %em This fund is hidden.
  %br
  - if @fund.user.stripe_key
    = link_to "Make this fund visible", fund_path(@fund, fund: {hidden: false}), method: :patch, class: 'btn btn-primary'
  - else
    %em You need to configure your payment information before making this course visible.
    %br
    %br
    = link_to "Update payment information", payment_path, class: 'btn btn-primary'

.break
%h3 About the Teacher
.big
  - if @fund.user.teacher_description.blank?
    %em This teacher has not given a description for themselves yet.
  - else
    = @fund.user.teacher_description.html_safe

.break
%h3 About this Fund
.big
  = @fund.body.html_safe

.break

= comment_area @fund


- if can? :manage, @fund
  .break
  %h4 Admin Actions
  .btn-group
    = link_to "Edit", edit_fund_path(@fund), class: 'btn'
    - if @fund.hidden == false
      = link_to "Hide", fund_path(@fund, fund: {hidden: true}), method: :patch, class: 'btn'
    = link_to "Delete", @fund, method: :delete, data: {confirm: "Are you sure you want to delete this fund? This action cannot be undone."}, class: 'btn'

  - if @fund.course && (@fund.course.approved != true)
    %h3 This fund has an unapproved course!
    %p= link_to @fund.course.title, @fund.course, class: "btn"
    %p= link_to "Mark as Approved", course_path(@fund.course, course: {approved: true}), method: :put, class: "btn btn-primary"


- content_for :sidebar do
  = progress_tag (@fund.percent_complete)
  %li.nav-header Goal Details
  %li.big
    Raised
    %strong= number_to_currency(@fund.progress)
    out of
    %strong= number_to_currency(@fund.goal)
  %br
  %li.big
    ending in
    %strong= @fund.time_ending
  %br
  %li.big= link_to "Support for <strong>#{number_to_currency(@fund.price)}</strong>".html_safe, new_fund_order_path(@fund), class: 'light-purple'
  %li.nav-header= "#{pluralize(@fund.orders.grouped.length, 'backer')}"
  - @fund.orders.grouped.each do |order|
    - if order.user_id
      %li
        %a{href: user_path(order.user)}
          = user_display(order.user) if order.user
          %span -
          %strong= number_to_currency(order.sum)

- content_for :js do
  :javascript
    _gaq.push(['_trackEvent','fund', 'show', '#{@fund.id} - #{escape_javascript(@fund.title)}']);

- t @fund.title.titleize
